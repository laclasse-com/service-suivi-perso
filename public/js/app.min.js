var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,e,d){a!=Array.prototype&&a!=Object.prototype&&(a[e]=d.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,e,d,f){if(e){d=$jscomp.global;a=a.split(".");for(f=0;f<a.length-1;f++){var g=a[f];g in d||(d[g]={});d=d[g]}a=a[a.length-1];f=d[a];e=e(f);e!=f&&null!=e&&$jscomp.defineProperty(d,a,{configurable:!0,writable:!0,value:e})}};$jscomp.polyfill("Object.is",function(a){return a?a:function(a,d){return a===d?0!==a||1/a===1/d:a!==a&&d!==d}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(a,d){var e=this;e instanceof String&&(e=String(e));var g=e.length;d=d||0;for(0>d&&(d=Math.max(d+g,0));d<g;d++){var b=e[d];if(b===a||Object.is(b,a))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(a,e,d){if(null==a)throw new TypeError("The 'this' value for String.prototype."+d+" must not be null or undefined");if(e instanceof RegExp)throw new TypeError("First argument to String.prototype."+d+" must not be a regular expression");return a+""};$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(a,d){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,d||0)}},"es6","es3");
$jscomp.findInternal=function(a,e,d){a instanceof String&&(a=String(a));for(var f=a.length,g=0;g<f;g++){var b=a[g];if(e.call(d,b,g,a))return{i:g,v:b}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.findIndex",function(a){return a?a:function(a,d){return $jscomp.findInternal(this,a,d).i}},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.Symbol=function(){var a=0;return function(e){return $jscomp.SYMBOL_PREFIX+(e||"")+a++}}();$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};
$jscomp.arrayIterator=function(a){var e=0;return $jscomp.iteratorPrototype(function(){return e<a.length?{done:!1,value:a[e++]}:{done:!0}})};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};
$jscomp.iteratorFromArray=function(a,e){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var d=0,f={next:function(){if(d<a.length){var g=d++;return{value:e(g,a[g]),done:!1}}f.next=function(){return{done:!0,value:void 0}};return f.next()}};f[Symbol.iterator]=function(){return f};return f};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();var e=a[Symbol.iterator];return e?e.call(a):$jscomp.arrayIterator(a)};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(a){function e(){this.batch_=null}function d(b){return b instanceof g?b:new g(function(c,a){c(b)})}if(a&&!$jscomp.FORCE_POLYFILL_PROMISE)return a;e.prototype.asyncExecute=function(b){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(b);return this};e.prototype.asyncExecuteBatch_=function(){var b=this;this.asyncExecuteFunction(function(){b.executeBatch_()})};var f=$jscomp.global.setTimeout;e.prototype.asyncExecuteFunction=function(b){f(b,
0)};e.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var b=this.batch_;this.batch_=[];for(var c=0;c<b.length;++c){var a=b[c];b[c]=null;try{a()}catch(l){this.asyncThrow_(l)}}}this.batch_=null};e.prototype.asyncThrow_=function(b){this.asyncExecuteFunction(function(){throw b;})};var g=function(b){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var c=this.createResolveAndReject_();try{b(c.resolve,c.reject)}catch(k){c.reject(k)}};g.prototype.createResolveAndReject_=
function(){function b(b){return function(k){a||(a=!0,b.call(c,k))}}var c=this,a=!1;return{resolve:b(this.resolveTo_),reject:b(this.reject_)}};g.prototype.resolveTo_=function(b){if(b===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(b instanceof g)this.settleSameAsPromise_(b);else{a:switch(typeof b){case "object":var c=null!=b;break a;case "function":c=!0;break a;default:c=!1}c?this.resolveToNonPromiseObj_(b):this.fulfill_(b)}};g.prototype.resolveToNonPromiseObj_=function(b){var c=
void 0;try{c=b.then}catch(k){this.reject_(k);return}"function"==typeof c?this.settleSameAsThenable_(c,b):this.fulfill_(b)};g.prototype.reject_=function(b){this.settle_(2,b)};g.prototype.fulfill_=function(b){this.settle_(1,b)};g.prototype.settle_=function(b,c){if(0!=this.state_)throw Error("Cannot settle("+b+", "+c+"): Promise already settled in state"+this.state_);this.state_=b;this.result_=c;this.executeOnSettledCallbacks_()};g.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=
0;a<this.onSettledCallbacks_.length;++a)b.asyncExecute(this.onSettledCallbacks_[a]);this.onSettledCallbacks_=null}};var b=new e;g.prototype.settleSameAsPromise_=function(b){var c=this.createResolveAndReject_();b.callWhenSettled_(c.resolve,c.reject)};g.prototype.settleSameAsThenable_=function(b,c){var a=this.createResolveAndReject_();try{b.call(c,a.resolve,a.reject)}catch(l){a.reject(l)}};g.prototype.then=function(b,c){function a(b,c){return"function"==typeof b?function(c){try{l(b(c))}catch(r){e(r)}}:
c}var l,e,d=new g(function(b,c){l=b;e=c});this.callWhenSettled_(a(b,l),a(c,e));return d};g.prototype.catch=function(b){return this.then(void 0,b)};g.prototype.callWhenSettled_=function(a,c){function k(){switch(l.state_){case 1:a(l.result_);break;case 2:c(l.result_);break;default:throw Error("Unexpected state: "+l.state_);}}var l=this;null==this.onSettledCallbacks_?b.asyncExecute(k):this.onSettledCallbacks_.push(k)};g.resolve=d;g.reject=function(b){return new g(function(c,a){a(b)})};g.race=function(b){return new g(function(c,
a){for(var l=$jscomp.makeIterator(b),e=l.next();!e.done;e=l.next())d(e.value).callWhenSettled_(c,a)})};g.all=function(b){var c=$jscomp.makeIterator(b),a=c.next();return a.done?d([]):new g(function(b,e){function l(c){return function(a){k[c]=a;p--;0==p&&b(k)}}var k=[],p=0;do k.push(void 0),p++,d(a.value).callWhenSettled_(l(k.length-1),e),a=c.next();while(!a.done)})};return g},"es6","es3");
angular.module("suiviApp",["ngColorPicker","ngResource","textAngular","ui.bootstrap","ui.router"]).constant("DEFAULT_RIGHTS_ONGLET",[{profile_type:"ENS",read:!0,write:!0,manage:!0},{profile_type:"EVS",read:!0,write:!0,manage:!0},{profile_type:"DOC",read:!0,write:!0,manage:!0},{profile_type:"DIR",read:!0,write:!0,manage:!0}]).config(["$httpProvider",function(a){a.defaults.withCredentials=!0}]).config(["$provide",function(a){a.decorator("taTranslations",["$delegate",function(a){a.html.tooltip="Basculer entre les vues HTML et texte enrichi";
a.justifyLeft.tooltip="Justifier \u00e0 gauche";a.justifyCenter.tooltip="Centrer";a.justifyRight.tooltip="Justifier \u00e0 droite";a.bold.tooltip="Mettre en gras";a.italic.tooltip="Mettre en italique";a.underline.tooltip="Souligner";a.insertLink.tooltip="Ins\u00e9rer un lien";a.insertLink.dialogPrompt="Lien \u00e0 ins\u00e9rer";a.editLink.targetToggle.buttontext="Le lien s'ouvrira dans une nouvelle fen\u00eatre";a.editLink.reLinkButton.tooltip="\u00c9diter le lien";a.editLink.unLinkButton.tooltip=
"Enlever le lien";a.insertImage.tooltip="Ins\u00e9rer une image";a.insertImage.dialogPrompt="URL de l'image :";a.insertVideo.tooltip="Ins\u00e9rer une vid\u00e9o";a.insertVideo.dialogPrompt="URL de la vid\u00e9o Youtube :";a.clear.tooltip="Enlever le formattage";a.ul.tooltip="Liste";a.ol.tooltip="Liste num\u00e9rot\u00e9e";a.quote.tooltip="Citation";a.undo.tooltip="Annuler";a.redo.tooltip="R\u00e9tablir";return a}]);a.decorator("taOptions",["$delegate","taRegisterTool",function(a,d){d("fontColor",
function(a){var d="backcolor"===a?"background-":"",b="#7bd148 #5484ed #a4bdfc #46d6db #7ae7bf #51b749 #fbd75b #ffb878 #ff887c #dc2127 #dbadff #e1e1e1".split(" ");"backcolor"===a&&b.push("transparent");return{couleurs:b,display:'\x3cspan uib-dropdown\x3e\x3ca uib-dropdown-toggle\x3e\x3ci class\x3d"fa fa-font" data-ng-style\x3d"{\''+d+'color\': selected }"\x3e\x3c/i\x3e \x3ci class\x3d"fa fa-caret-down"\x3e\x3c/i\x3e\x3c/a\x3e\x3cng-color-picker uib-dropdown-menu selected\x3d"selected" colors\x3d"couleurs"\x3e\x3c/ng-color-picker\x3e\x3c/span\x3e',
action:function(){return"nil"===this.selected?!1:this.$editor().wrapSelection(a,this.selected)}}}("forecolor"));d("table",{columns:{value:1,hovered:1},rows:{value:1,hovered:1},hover:function(a,d){a.hovered=d},leave:function(a){a.hovered=a.value},tooltiptext:"ins\u00e9rer un tableau",display:'\n              \x3cspan uib-dropdown\x3e\n                \x3ca uib-dropdown-toggle\x3e\n                  \x3ci class\x3d"fa fa-table"\x3e\n                  \x3c/i\x3e\n                  \x3ci class\x3d"fa fa-caret-down"\x3e\n                  \x3c/i\x3e\n                \x3c/a\x3e\n                \x3cdiv uib-dropdown-menu data-ng-click\x3d"$event.stopPropagation()"\x3e\n                  \x3clabel\x3e\n                    \x3cspan uib-rating on-hover\x3d"hover( columns, value )" on-leave\x3d"leave( columns )" ng-model\x3d"columns.value" max\x3d"15" state-on\x3d"\'glyphicon-stop\'" state-off\x3d"\'glyphicon-unchecked\'"\x3e\n                    \x3c/span\x3e\n                    \x3cbr\x3e{{columns.hovered}} colonnes\n                  \x3c/label\x3e\n                  \x3cbr\x3e\n                    \x3clabel\x3e\n                      \x3cspan uib-rating on-hover\x3d"hover( rows, value )" on-leave\x3d"leave( rows )" ng-model\x3d"rows.value" max\x3d"15" state-on\x3d"\'glyphicon-stop\'" state-off\x3d"\'glyphicon-unchecked\'"\x3e\n                      \x3c/span\x3e\n                      \x3cbr\x3e{{rows.hovered}} lignes\n                    \x3c/label\x3e\n                    \x3cbr\x3e\n                      \x3cbutton class\x3d"btn btn-success" data-ng-click\x3d"insert_table()"\x3eIns\u00e9rer\x3c/button\x3e\n                    \x3c/div\x3e\n                  \x3c/span\x3e\n',
insert_table:function(){var a="";_(this.columns.value).times(function(b){a+="\x3ctd\x3e\x26nbsp;\x3c/td\x3e"});var d="";_(this.rows.value).times(function(b){d=d+"\x3ctr\x3e"+a+"\x3c/tr\x3e"});this.$editor().wrapSelection("insertHTML",'\x3ctable class\x3d"table table-bordered"\x3e'+d+"\x3c/table\x3e");this.deferration.resolve()},action:function(a){this.deferration=a;return!1}});a.toolbar=["bold italics underline ul ol quote fontColor justifyLeft justifyCenter justifyRight table insertLink insertImage html undo redo".split(" ")];
a.classes={focussed:"focussed",toolbar:"btn-toolbar",toolbarGroup:"btn-group",toolbarButton:"btn btn-default",toolbarButtonActive:"active",disabled:"disabled",textEditor:"form-control",htmlEditor:"form-control"};return a}]);a.decorator("taTools",["$delegate",function(a){a.html.buttontext="HTML";return a}])}]);
angular.module("suiviApp").config(["$stateProvider","$urlRouterProvider",function(a,e){e.otherwise("/");a.state("trombinoscope",{url:"/",component:"trombinoscope"}).state("student",{url:"/student/:uids",params:{uids:{array:!0}},component:"student",resolve:{uids:["$transition$",function(a){return a.params().uids}]}})}]);
angular.module("suiviApp").component("droits",{bindings:{uidEleve:"\x3c",droits:"\x3d",concernedPeople:"\x3c"},controller:["Droits","APIs","UID","URL_ENT","User",function(a,e,d,f,g){var b=this;b.sharing_enabled=!1;b.groups=[];var h=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})},c=function(a){void 0==a.dirty&&(a.dirty={uid:!1,profile_type:!1,group_id:!1,sharable_id:!1,read:!1,write:!1,manage:!1})};
b.add=function(k){k.new=!0;c(k);b.droits.push(new a(k))};b.add_sharable=function(a){a.sharable_id=h();b.add(a)};b.set_read=function(a){c(a);a.dirty.read=!0;!a.read&&a.write&&(a.write=!1,a.dirty.write=!0);!a.read&&a.manage&&(a.manage=!1,a.dirty.manage=!0)};b.set_write=function(a){c(a);a.dirty.write=!0;a.write&&!a.read&&(a.read=!0,a.dirty.read=!0);!a.write&&a.manage&&(a.manage=!1,a.dirty.manage=!0)};b.set_manage=function(a){c(a);a.dirty.manage=!0;a.manage&&!a.write&&(a.write=!0,a.dirty.write=!0);a.manage&&
!a.read&&(a.read=!0,a.dirty.read=!0)};b.update_deletabilities=function(){b.droits.forEach(function(a){a.deletable=a.uid!=d;void 0!=b.uidEleve&&(a.deletable=a.deletable&&a.uid!=b.uidEleve)})};b.$onInit=function(){b.update_deletabilities();e.query_profiles_types().then(function(a){b.profils=a.data},function(a){});g.get({id:d}).$promise.then(function(a){return a.get_actual_groups()}).then(function(a){b.groups=a.filter(function(a){return"GPL"==a.type}).map(function(a){a.pretty_type={CLS:"Classes",GRP:"Groupes d'\u00e9l\u00e8ves",
GPL:"Groupes libres"}[a.type];return a})},function(a){});void 0==b.concernedPeople&&(b.concernedPeople=[]);var a=b.concernedPeople.map(function(a){return a.id});e.get_users(b.droits.filter(function(b){return void 0!=b.uid&&!a.includes(b.uid)}).map(function(a){return a.uid})).then(function(a){b.concernedPeople=b.concernedPeople.concat(a.data)})}}],template:'\n                     \x3cdiv\x3e\n                       \x3clabel\x3eGestion des droits\x3c/label\x3e\n                       \x3ctable style\x3d"width: 100%;"\x3e\n                         \x3ctr style\x3d"text-align: right;"\n                             ng:repeat\x3d"droit in $ctrl.droits"\n                             ng:if\x3d"ctrl.sharing_enabled || !droit.sharable_id"\x3e\n                           \x3ctd\x3e\n                             \x3clabel ng:if\x3d"droit.uid"\x3ePersonne :\n                               \x3cselect style\x3d"width: 250px;"\n                                       ng:model\x3d"droit.uid"\n                                       ng:change\x3d"droit.dirty.uid \x3d true"\n                                       ng:disabled\x3d"droit.to_delete"\n                                       ng:options\x3d"people.id as people.firstname + \' \' + people.lastname group by people.type for people in $ctrl.concernedPeople"\x3e\n                               \x3c/select\x3e\n                             \x3c/label\x3e\n\n                             \x3clabel ng:if\x3d"droit.profile_type"\x3eProfil :\n                               \x3cselect style\x3d"width: 250px;"\n                                       ng:model\x3d"droit.profile_type"\n                                       ng:change\x3d"droit.dirty.profile_type \x3d true"\n                                       ng:disabled\x3d"droit.to_delete"\x3e\n                                 \x3coption ng:repeat\x3d"profil in $ctrl.profils track by profil.id"\n                                         ng:value\x3d"profil.id"\x3e{{profil.name}}\x3c/option\x3e\n                               \x3c/select\x3e\n                             \x3c/label\x3e\n\n                             \x3clabel ng:if\x3d"droit.group_id"\x3eGroupe :\n                               \x3cselect style\x3d"width: 250px;"\n                                       ng:model\x3d"droit.group_id"\n                                       ng:change\x3d"droit.dirty.group_id \x3d true"\n                                       ng:disabled\x3d"droit.to_delete"\n                                       ng:options\x3d"group.id as group.name group by group.pretty_type for group in $ctrl.groups"\x3e\n                               \x3c/select\x3e\n                             \x3c/label\x3e\n\n                             \x3clabel ng:if\x3d"droit.sharable_id"\x3ePartage :\n                               \x3cinput style\x3d"width: 250px;"\n                                      type\x3d"text"\n                                      ng:model\x3d"droit.sharable_id"\n                                      ng:change\x3d"droit.dirty.sharable_id \x3d true"\n                                      ng:disabled\x3d"droit.to_delete" /\x3e\n                             \x3c/label\x3e\n                           \x3c/td\x3e\n                           \x3ctd\x3e\n                             \x3cbutton type\x3d"button" class\x3d"btn"\n                                     ng:class\x3d"{\'btn-default\': !droit.read, \'btn-success\': droit.read}"\n                                     ng:model\x3d"droit.read"\n                                     ng:change\x3d"$ctrl.set_read( droit )"\n                                     ng:disabled\x3d"droit.to_delete || droit.sharable_id"\n                                     uib:btn-checkbox\n                                     btn-checkbox-true\x3d"true"\n                                     btn-checkbox-false\x3d"false"\n                                     uib:tooltip\x3d"droit de lecture"\x3e\n                               \x3cspan class\x3d"glyphicon glyphicon-eye-open"\x3e\x3c/span\x3e\n                             \x3c/button\x3e\n                           \x3c/td\x3e\n                           \x3ctd\x3e\n                             \x3cbutton type\x3d"button" class\x3d"btn"\n                                     ng:class\x3d"{\'btn-default\': !droit.write, \'btn-success\': droit.write}"\n                                     ng:model\x3d"droit.write"\n                                     ng:change\x3d"$ctrl.set_write( droit )"\n                                     ng:disabled\x3d"droit.to_delete || droit.sharable_id"\n                                     uib:btn-checkbox\n                                     btn-checkbox-true\x3d"true"\n                                     btn-checkbox-false\x3d"false"\n                                     uib:tooltip\x3d"droit d\'\u00e9criture"\x3e\n                               \x3cspan class\x3d"glyphicon glyphicon-edit"\x3e\x3c/span\x3e\n                             \x3c/button\x3e\n                           \x3c/td\x3e\n                           \x3ctd\x3e\n                             \x3cbutton type\x3d"button" class\x3d"btn"\n                                     ng:class\x3d"{\'btn-default\': !droit.manage, \'btn-success\': droit.manage}"\n                                     ng:model\x3d"droit.manage"\n                                     ng:change\x3d"$ctrl.set_manage( droit )"\n                                     ng:disabled\x3d"droit.to_delete || droit.sharable_id"\n                                     uib:btn-checkbox\n                                     btn-checkbox-true\x3d"true"\n                                     btn-checkbox-false\x3d"false"\n                                     uib:tooltip\x3d"droit d\'administration"\x3e\n                               \x3cspan class\x3d"glyphicon glyphicon-cog"\x3e\x3c/span\x3e\n                             \x3c/button\x3e\n                           \x3c/td\x3e\n                           \x3ctd\x3e\n                             \x3cbutton type\x3d"button" class\x3d"btn"\n                                     ng:class\x3d"{\'btn-default\': !droit.to_delete, \'btn-warning\': droit.to_delete}"\n                                     ng:disabled\x3d"!droit.deletable \x26\x26 !droit.to_delete"\n                                     ng:model\x3d"droit.to_delete"\n                                     ng:change\x3d"$ctrl.update_deletabilities()"\n                                     uib:btn-checkbox\n                                     btn-checkbox-true\x3d"true"\n                                     btn-checkbox-false\x3d"false"\x3e\n                               \x3cspan class\x3d"glyphicon glyphicon-trash"\x3e\x3c/span\x3e\n                             \x3c/button\x3e\n                           \x3c/td\x3e\n                         \x3c/tr\x3e\n                         \x3ctfoot\x3e\n                           \x3ctd colspan\x3d"3"\x3e\n                             \x3cbutton class\x3d"btn btn-default"\n                                     ng:click\x3d"$ctrl.add({ uid: \'...\', read: true, write: true })"\x3e\n                               \x3cspan class\x3d"glyphicon glyphicon-plus-sign"\x3e\x3c/span\x3e par personne\n                             \x3c/button\x3e\n\n                             \x3cbutton class\x3d"btn btn-default"\n                                     ng:click\x3d"$ctrl.add({ profile_type: \'...\', read: true, write: false })"\x3e\n                               \x3cspan class\x3d"glyphicon glyphicon-plus-sign"\x3e\x3c/span\x3e par profil\n                             \x3c/button\x3e\n\n                             \x3cbutton class\x3d"btn btn-default"\n                                     ng:click\x3d"$ctrl.add({ group_id: \'...\', read: true, write: false })"\n                                     ng:if\x3d"$ctrl.groups.length \x3e 0"\x3e\n                               \x3cspan class\x3d"glyphicon glyphicon-plus-sign"\x3e\x3c/span\x3e par groupe\n                             \x3c/button\x3e\n\n                             \x3cbutton class\x3d"btn btn-warning pull-right"\n                                     ng:if\x3d"ctrl.sharing_enabled"\n                                     ng:click\x3d"$ctrl.add_sharable({ read: true, write: false })"\x3e\n                               \x3cspan class\x3d"glyphicon glyphicon-plus-sign"\x3e\x3c/span\x3e partage\n                             \x3c/button\x3e\n                           \x3c/td\x3e\n                         \x3c/tfoot\x3e\n                       \x3c/table\x3e\n                     \x3c/div\x3e\n'});
angular.module("suiviApp").config(["$compileProvider",function(a){a.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|javascript|blob|data):/)}]).component("onglet",{bindings:{uids:"\x3c",onglets:"\x3c",onglet:"\x3d"},controller:["$uibModal","$state","$q","$window","$sce","$location","Saisies",function(a,e,d,f,g,b,h){var c=this;c.order_by={field:"date",reverse:!0};c.callback_popup_onglet=function(a){"deleted"==a.action&&e.go("student",{uids:c.uids},{reload:!0})};c.saisie_callback=function(a){switch(a.action){case "created":c.saisies.push(a);
k();break;case "deleted":c.saisies=c.saisies.filter(function(b){return b.id!=a.id});break;case "updated":var b=c.saisies.findIndex(function(b){return b.id==a.id});c.saisies[b]=a;break;default:console.log("What to do with this?"),console.log(a)}};var k=function(){c.new_saisie=c.onglet.writable?{create_me:!0}:null};a=function(a){return function(){return function(b){return b.pinned==a}}};c.filter_pinned=a(!0);c.filter_unpinned=a(!1);c.$onInit=function(){k();h.query({"onglets_ids[]":c.onglet.ids}).$promise.then(function(a){c.saisies=
a},function(a){})}}],template:'\n                  \x3csaisie class\x3d"col-md-12" style\x3d"display: inline-block;"\n                          ng:repeat\x3d"saisie in $ctrl.saisies | filter:$ctrl.filter_pinned() | orderBy:$ctrl.order_by.field:$ctrl.order_by.reverse"\n                          onglet\x3d"$ctrl.onglet"\n                          saisie\x3d"saisie"\n                          callback\x3d"$ctrl.saisie_callback( saisie )"\x3e\x3c/saisie\x3e\n\n                  \x3csaisie class\x3d"col-md-12"\n                          style\x3d"display: inline-block;"\n                          ng:if\x3d"$ctrl.new_saisie"\n                          onglet\x3d"$ctrl.onglet"\n                          saisie\x3d"$ctrl.new_saisie"\n                          callback\x3d"$ctrl.saisie_callback( $ctrl.new_saisie )"\x3e\x3c/saisie\x3e\n\n                  \x3cdiv class\x3d"col-md-12" style\x3d"margin-bottom: 10px;"\x3e\n                    \x3cbutton class\x3d"btn btn-sm btn-primary pull-right"\n                            ng:click\x3d"$ctrl.order_by.reverse \x3d !$ctrl.order_by.reverse"\n                            ng:if\x3d"$ctrl.saisies.length \x3e 1"\x3e\n                      \x3cspan class\x3d"glyphicon"\n                            ng:class\x3d"{\'glyphicon-sort-by-order\': $ctrl.order_by.reverse, \'glyphicon-sort-by-order-alt\': !$ctrl.order_by.reverse}"\x3e\x3c/span\x3e\n                      Trier par la date de publication la plus \x3cspan ng:if\x3d"$ctrl.order_by.reverse"\x3er\u00e9cente\x3c/span\x3e\x3cspan ng:if\x3d"!$ctrl.order_by.reverse"\x3eancienne\x3c/span\x3e.\n                    \x3c/button\x3e\n                  \x3c/div\x3e\n\n                  \x3cdiv class\x3d"col-md-12 saisies" style\x3d"overflow-y: auto;"\x3e\n\n                    \x3csaisie class\x3d"col-md-12" style\x3d"display: inline-block;"\n                            ng:repeat\x3d"saisie in $ctrl.saisies | filter:$ctrl.filter_unpinned() | orderBy:$ctrl.order_by.field:$ctrl.order_by.reverse"\n                            onglet\x3d"$ctrl.onglet"\n                            saisie\x3d"saisie"\n                            callback\x3d"$ctrl.saisie_callback( saisie )"\x3e\x3c/saisie\x3e\n                  \x3c/div\x3e\n'});
angular.module("suiviApp").component("onglets",{bindings:{uids:"\x3c"},controller:["$uibModal","Onglets","Popups","APIs","User","UID",function(a,e,d,f,g,b){var h=this;h.popup_onglet=d.onglet;h.callback_popup_onglet=function(a){"created"==a.action&&(a=_(a).groupBy("name"),h.onglets=h.onglets.concat(Object.keys(a).map(function(b){return{name:b,ids:a[b].map(function(a){return a.id}),writable:a[b].reduce(function(a,b){return a&&b.writable},!0),manageable:a[b].reduce(function(a,b){return a&&b.manageable},
!0)}})));a.deleted&&(h.onglets=h.onglets.filter(function(b){return b.name!=a.name}));Array.isArray(a)&&a[0].deleted&&(h.onglets=h.onglets.filter(function(b){return b.name!=a[0].name}))};h.$onInit=function(){1==h.uids.length?d.loading_window("Chargement des onglets","",function(){return e.query({"uids[]":h.uids}).$promise.then(function(a){h.onglets=_(a[0]).map(function(a){a.ids=[a.id];return a})},function(a){})}):d.loading_window("Chargement des onglets communs","",function(){return f.query_common_onglets_of(h.uids).then(function(a){h.onglets=
Object.keys(a).map(function(b){return{name:b,ids:a[b].map(function(a){return a.id}),writable:a[b].reduce(function(a,b){return a&&b.writable},!0),manageable:a[b].reduce(function(a,b){return a&&b.manageable},!0)}})})});g.get({id:b}).$promise.then(function(a){h.current_user=a;h.can_add_tab=h.current_user.can_add_tab(h.uids)})}}],template:'\n  \x3cstyle\x3e\n    .manage-onglet { margin-top: -16px; margin-right: -16px; height: 28px; border-radius: 0 0 0 12px; }\n  \x3c/style\x3e\n  \x3cuib-tabset\x3e\n    \x3cuib-tab ng:repeat\x3d"onglet in $ctrl.onglets"\x3e\n      \x3cuib-tab-heading\x3e {{onglet.name}}\n        \x3cbutton class\x3d"btn btn-warning manage-onglet"\n                ng:if\x3d"onglet.manageable"\n                ng:click\x3d"$ctrl.popup_onglet( $ctrl.uids, onglet, $ctrl.onglets, $ctrl.callback_popup_onglet )"\x3e\n          \x3cspan class\x3d"glyphicon glyphicon-cog"\x3e\x3c/span\x3e\n        \x3c/button\x3e\n      \x3c/uib-tab-heading\x3e\n\n      \x3conglet uids\x3d"$ctrl.uids"\n              onglets\x3d"$ctrl.onglets"\n              onglet\x3d"onglet"\x3e\n      \x3c/onglet\x3e\n    \x3c/uib-tab\x3e\n\n    \x3cli\x3e\n      \x3ca href\n         class\x3d"bleu add-onglet"\n         ng:click\x3d"$ctrl.popup_onglet( $ctrl.uids, null, $ctrl.onglets, $ctrl.callback_popup_onglet )"\n         ng:if\x3d"$ctrl.can_add_tab"\x3e\n        \x3cspan class\x3d"glyphicon glyphicon-plus"\x3e\n        \x3c/span\x3e\n      \x3c/a\x3e\n    \x3c/li\x3e\n  \x3c/uib-tabset\x3e\n'});
angular.module("suiviApp").component("saisie",{bindings:{onglet:"\x3c",saisie:"\x3d",callback:"\x26"},controller:["$sce","Saisies","APIs","User","UID",function(a,e,d,f,g){var b=this;b.toggle_edit=function(){b.edition=!b.edition;b.edition?b.previous_content=b.saisie.content:b.saisie.trusted_content=a.trustAsHtml(b.saisie.content)};b.cancel=function(){b.saisie.content=b.previous_content;b.toggle_edit()};b.save=function(){b.saisie.pinned=b.saisie.tmp_pinned||!1;_(b.saisie).has("$save")||(b.saisie.onglets_ids=
b.onglet.ids,b.saisie=new e(b.saisie));(b.new_saisie?b.saisie.$save():b.saisie.$update()).then(function(a){b.new_saisie||b.toggle_edit();b.saisie.action=b.new_saisie?"created":"updated";b.callback()},function(a){console.log(a)})};b.delete=function(){swal({title:"\u00cates-vous sur ?",text:"La saisie sera d\u00e9finitivement supprim\u00e9e !",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",confirmButtonText:"Oui, je confirme !",cancelButtonText:"Annuler"}).then(function(a){"cancel"!=
a.dismiss&&e.delete({id:b.saisie.id,"onglets_ids[]":b.onglet.ids}).$promise.then(function(){b.saisie.action="deleted";b.callback()})})};b.$onInit=function(){(b.edition=b.saisie.create_me)?(b.new_saisie=!0,b.saisie.content="",b.saisie.tmp_pinned=!1):(b.saisie=new e(b.saisie),b.saisie.tmp_pinned=b.saisie.pinned);b.saisie.trusted_content=a.trustAsHtml(b.saisie.content);f.get({id:g}).$promise.then(function(a){b.current_user=a;b.editable=b.new_saisie||_(b).has("onglet")&&(b.onglet.manageable||b.onglet.writable&&
b.saisie.uid_author==b.current_user.id)||b.current_user.is_admin()});b.toolbar_id=b.new_saisie?2048*Math.random()+"":b.saisie.id};b.$onChanges=function(d){b.saisie.trusted_content=a.trustAsHtml(b.saisie.content)}}],template:'\n                   \x3cdiv class\x3d"panel panel-default saisie-display" ng:class\x3d"{\'new-saisie\': $ctrl.new_saisie}"\x3e\n                     \x3cspan style\x3d"position: absolute; top: 0; right: 15px;height: 0;width: 0;text-align: center; color: #fff; border-color: transparent #fa0 transparent transparent;border-style: solid;border-width: 0 50px 50px 0; z-index: 1;"\n                           ng:if\x3d"$ctrl.saisie.tmp_pinned"\x3e\n                       \x3cspan class\x3d"glyphicon glyphicon-pushpin" style\x3d"margin-left: 25px;font-size: 22px;margin-top: 3px;"\x3e\x3c/span\x3e\n                     \x3c/span\x3e\n\n                     \x3cdiv class\x3d"panel-heading" ng:if\x3d"$ctrl.saisie.id \x26\x26 !$ctrl.saisie.tmp_pinned"\x3e\n                       \x3cuser-details class\x3d"col-md-4"\n                                     ng:if\x3d"!$ctrl.saisie.new_saisie"\n                                     uid\x3d"$ctrl.saisie.uid_author"\n                                     small\x3d"true"\n                                     show-avatar\x3d"true"\x3e\x3c/user-details\x3e\n                       {{$ctrl.saisie.ctime | date:\'medium\'}}\n                       \x3cdiv class\x3d"clearfix"\x3e\x3c/div\x3e\n                     \x3c/div\x3e\n\n                     \x3cdiv class\x3d"panel-body" ng:style\x3d"{\'padding\': $ctrl.new_saisie ? 0 : \'inherit\', \'border\': $ctrl.new_saisie ? 0 : \'inherit\'}"\x3e\n\n                       \x3cdiv class\x3d"col-md-12"\n                            ta-bind\n                            ng:model\x3d"$ctrl.saisie.trusted_content"\n                            ng:if\x3d"!$ctrl.edition"\x3e\x3c/div\x3e\n\n                       \x3cdiv class\x3d"col-md-12"\n                            ng:style\x3d"{\'padding\': $ctrl.new_saisie ? 0 : \'inherit\'}"\n                            ng:if\x3d"$ctrl.edition"\x3e\n                         \x3ctext-angular ta:target-toolbars\x3d"main-ta-toolbar-{{$ctrl.toolbar_id}}"\n                                       ng:model\x3d"$ctrl.saisie.content"\n                                       ng:change\x3d"$ctrl.dirty \x3d true"\x3e\x3c/text-angular\x3e\n                         \x3cdiv class\x3d"suivi-ta-toolbar gris2-moins"\x3e\n                           \x3ctext-angular-toolbar class\x3d"pull-left"\n                                                 style\x3d"margin-left: 0;"\n                                                 name\x3d"main-ta-toolbar-{{$ctrl.toolbar_id}}"\x3e\x3c/text-angular-toolbar\x3e\n\n                           \x3cbutton class\x3d"btn" style\x3d"margin-left: 6px;"\n                                   ng:model\x3d"$ctrl.saisie.tmp_pinned"\n                                   ng:change\x3d"$ctrl.dirty \x3d true"\n                                   ng:class\x3d"{\'btn-warning\': $ctrl.saisie.tmp_pinned, \'btn-default\': !$ctrl.saisie.tmp_pinned}"\n                                   uib:btn-checkbox\n                                   btn:checkbox-true\x3d"true"\n                                   btn:checkbox-false\x3d"false"\x3e\n                             \x3cspan class\x3d"glyphicon glyphicon-pushpin" \x3e\x3c/span\x3e \u00c9pingler\n                           \x3c/button\x3e\n\n                           \x3cbutton class\x3d"btn btn-success pull-right"\n                                   ng:disabled\x3d"!$ctrl.dirty || !$ctrl.onglet"\n                                   ng:click\x3d"$ctrl.save()"\x3e\n                             \x3cspan class\x3d"glyphicon glyphicon-save" \x3e\x3c/span\x3e Publier\n                           \x3c/button\x3e\n                           \x3cbutton class\x3d"btn btn-default pull-right"\n                                   ng:click\x3d"$ctrl.cancel()"\n                                   ng:if\x3d"$ctrl.saisie.id"\x3e\n                             \x3cspan class\x3d"glyphicon glyphicon-edit" \x3e\x3c/span\x3e Annuler\n                           \x3c/button\x3e\n\n                           \x3cbutton class\x3d"btn btn-danger pull-right"\n                                   ng:click\x3d"$ctrl.delete()"\n                                   ng:if\x3d"$ctrl.saisie.id \x26\x26 ( $ctrl.editable || $ctrl.onglet.manageable || $ctrl.current_user.is_admin() )"\x3e\n                             \x3cspan class\x3d"glyphicon glyphicon-trash"\x3e\x3c/span\x3e Supprimer\n                           \x3c/button\x3e\n                           \x3cdiv class\x3d"clearfix"\x3e\x3c/div\x3e\n                         \x3c/div\x3e\n                       \x3c/div\x3e\n                     \x3c/div\x3e\n\n                     \x3cdiv class\x3d"panel-footer" ng:if\x3d"!$ctrl.edition"\x3e\n                       \x3cdiv class\x3d"pull-right buttons"\x3e\n                         \x3cbutton class\x3d"btn btn-default"\n                                 ng:click\x3d"$ctrl.toggle_edit()"\n                                 ng:if\x3d"$ctrl.editable"\x3e\n                           \x3cspan class\x3d"glyphicon glyphicon-edit" \x3e\x3c/span\x3e \u00c9diter\n                         \x3c/button\x3e\n                       \x3c/div\x3e\n                       \x3cdiv class\x3d"clearfix"\x3e\x3c/div\x3e\n                     \x3c/div\x3e\n                   \x3c/div\x3e\n\n'});
angular.module("suiviApp").component("student",{bindings:{uids:"\x3c"},template:'\n               \x3cdiv class\x3d"col-md-4 gris1-moins aside aside-student"\x3e\n                 \x3ca class\x3d"col-md-12 btn btn-lg noir-moins go-back" ui:sref\x3d"trombinoscope()"\x3e \u21b0 Retour au trombinoscope \x3c/a\x3e\n\n                 \x3cuser-details class\x3d"user-details eleve"\n                               uid\x3d"$ctrl.uids[0]"\n                               show-avatar\x3d"true"\n                               show-emails\x3d"true"\n                               show-classe\x3d"true"\n                               show-birthdate\x3d"true"\n                               show-address\x3d"true"\n                               show-concerned-people\x3d"true"\n                               ng:if\x3d"$ctrl.uids.length \x3d\x3d 1"\x3e\x3c/user-details\x3e\n\n                 \x3cul ng:if\x3d"$ctrl.uids.length \x3e 1"\x3e\n                   \x3cli style\x3d"list-style-type: none;"\n                       ng:repeat\x3d"uid in $ctrl.uids"\x3e\n                     \x3ca class\x3d"eleve"\n                        ui:sref\x3d"student({uids: [uid]})"\x3e\n                       \x3cuser-details class\x3d"user-details eleve"\n                                     uid\x3d"uid"\n                                     small\x3d"true"\n                                     show-avatar\x3d"true"\n                                     show-classe\x3d"true"\x3e\x3c/user-details\x3e\n                     \x3c/a\x3e\n                   \x3c/li\x3e\n                 \x3c/ul\x3e\n               \x3c/div\x3e\n\n               \x3conglets class\x3d"col-md-8 student"\n                        uids\x3d"$ctrl.uids"\x3e\x3c/onglets\x3e\n'});
angular.module("suiviApp").component("trombinoscope",{controller:["$filter","$q","URL_ENT","APIs","Popups","User","UID",function(a,e,d,f,g,b,h){var c=this;c.pretty_labels={CLS:"classe",GRP:"groupe d'\u00e9l\u00e8ves",GPL:"groupe libre"};c.popup_onglet_batch=g.onglet_batch;c.popup_batch=g.batch;c.popup_onglet_batch_callback=function(a){console.log(a)};c.popup_publish_batch=g.publish_batch;c.filters={text:"",groups:[],grades:[]};c.only_display_relevant_to=!1;c.eleves=[];c.groups=[];c.structures=[];
var k=function(a){return(_(a.match(/^(user|http)/)).isNull()?d+"/":"")+a};c.apply_filters=function(){var a=_.chain(c.structures).where({selected:!0}).pluck("id").value(),b=_.chain(c.groups).where({selected:!0}).pluck("id").value(),d=_.chain(c.grades).where({selected:!0}).pluck("id").value(),e=function(a){return _.chain(c.groups).select(function(b){return _(a).contains(b.id)}).pluck("grades").flatten().pluck("grade_id").uniq().value()},p=function(a){return _.chain(c.groups).select(function(b){return _(a).contains(b.id)}).pluck("structure_id").uniq().value()};
return function(f){return(""+f.firstname+f.lastname).toLocaleLowerCase().includes(c.filters.text.toLocaleLowerCase())&&(0==a.length||0<_(a).intersection(p(_(f.groups).pluck("group_id"))).length)&&(0==b.length||0<_(b).intersection(_(f.groups).pluck("group_id")).length)&&(0==d.length||0<_(d).intersection(e(_(f.groups).pluck("group_id"))).length)&&(!c.only_display_relevant_to||f.relevant)}};c.clear_filters=function(a){_(["CLS","GRP","GPL"]).contains(a)?_.chain(c.groups).select(function(b){return b.selected&&
b.type==a}).each(function(a){a.selected=!1}):_(c[a]).each(function(a){a.selected=!1})};c.pluck_selected_uids=function(){var a=c.apply_filters();return _.chain(c.eleves).select(function(b){return a(b)}).reject(function(a){return a.excluded}).pluck("id").value()};c.pluriel=function(a,b){return 1<a?b:""};b.get({id:h}).$promise.then(function(a){c.current_user=a;c.current_user.avatar=k(c.current_user.avatar);return f.query_relevant_students(c.current_user.id)},function(a){}).then(function(a){c.relevant_to=
a.data;return c.current_user.get_actual_groups()},function(a){}).then(function(a){var b=[],d=[],g=function(a){c.groups=c.groups.concat(_(a).select(function(a){return"GPL"==a.type||void 0!=_(a.users).findWhere({type:"ELV"})}));c.groups=_(c.groups).uniq(function(a){return a.id});f.get_grades(_.chain(c.groups).pluck("grades").flatten().pluck("grade_id").value()).then(function(a){c.grades=a.data},function(a){});b=b.concat(_.chain(a).pluck("users").flatten().compact().select(function(a){return"ELV"==a.type}).pluck("user_id").value())},
p=function(a){1<a.length&&f.get_structures(a).then(function(a){c.structures=c.structures.concat(a.data);c.structures=_(c.structures).uniq(function(a){return a.id})})};_.chain(c.current_user.profiles).pluck("type").contains("ELV").value()&&b.push(c.current_user.id);b=b.concat(_(c.current_user.children).pluck("child_id"));a=_.chain(a).reject(function(a){return _(["ELV"]).contains(a.type)}).pluck("id").value();0<a.length&&d.push(f.get_groups(a).then(function(a){p(_.chain(a.data).pluck("structure_id").uniq().value());
g(a.data)}));a=_.chain(c.current_user.profiles).select(function(a){return _("ADM DIR DOC ETA EVS ORI".split(" ")).contains(a.type)}).pluck("structure_id").uniq().value();_(a).isEmpty()||(p(a),d.push(f.get_groups_of_structures(a).then(function(a){g(a.data)})));e.all(d).then(function(){for(b=_(b).uniq();0<b.length;)f.get_users(b.splice(0,200)).then(function(a){c.eleves=c.eleves.concat(_(a.data).map(function(a){a.avatar=k(a.avatar);a.excluded=!1;a.relevant=_(c.relevant_to).contains(a.id);var b=_.chain(a.groups).map(function(a){return _(c.groups).findWhere({id:a.group_id,
type:"CLS"})}).compact().first().value();void 0!=b&&(a.regroupement={id:b.id,name:b.name,type:b.type},a.etablissement=b.structure_id,a.enseignants=b.profs);return a}));c.eleves=_(c.eleves).uniq(function(a){return a.id})})})})}],template:'\n\x3cstyle\x3e\n  .trombinoscope .petite.case { border: 1px solid transparent; }\n  .filter .panel-body { max-height: 380px; overflow-y: auto; }\n  .trombinoscope .excluded .eleve { opacity: 0.8; }\n  .regroupement {background-color: rgba(240, 240, 240, 0.66);}\n  .trombinoscope .excluded .eleve .full-name { color: lightgray; text-decoration: double line-through; }\n\x3c/style\x3e\n\x3cdiv class\x3d"col-md-4 gris1-moins aside trombinoscope-aside" style\x3d"padding: 0;"\x3e\n  \x3cdiv class\x3d"panel panel-default gris1-moins"\x3e\n    \x3cdiv class\x3d"panel-heading" style\x3d"text-align: right; "\x3e\n      \x3ch3\x3e\n        {{$ctrl.pluck_selected_uids().length}} \u00e9l\u00e8ve{{$ctrl.pluriel($ctrl.pluck_selected_uids().length, \'s\')}}\x3cspan ng:if\x3d"$ctrl.current_user.can_do_batch"\x3e s\u00e9lectionn\u00e9{{$ctrl.pluriel($ctrl.filtered.length, \'s\')}}\x3c/span\x3e\n\n        \x3ca class\x3d"btn btn-primary"\n           title\x3d"Gestion des onglets communs"\n           ng:if\x3d"$ctrl.current_user.can_do_batch"\n           ui:sref\x3d"student({uids: $ctrl.pluck_selected_uids()})"\x3e\n          \x3cspan class\x3d"glyphicon glyphicon-user"\x3e\x3c/span\x3e\n          \x3cspan class\x3d"glyphicon glyphicon-user" style\x3d"font-size: 125%; margin-left: -11px; margin-right: -11px;"\x3e\x3c/span\x3e\n          \x3cspan class\x3d"glyphicon glyphicon-user"\x3e\x3c/span\x3e\n        \x3c/a\x3e\n      \x3c/h3\x3e\n    \x3c/div\x3e\n    \x3cdiv class\x3d"panel-body"\x3e\n\n      \x3cdiv class\x3d"row"\x3e\n        \x3cdiv class\x3d"col-md-12"\x3e\n          \x3cinput class\x3d"form-control input-lg"\n                 style\x3d"display: inline; background-color: rgba(240, 240, 240, 0.66);"\n                 type\x3d"text" name\x3d"search"\n                 ng:model\x3d"$ctrl.filters.text" /\x3e\n          \x3cbutton class\x3d"btn btn-xs" style\x3d"color: green; margin-left: -44px; margin-top: -4px;"\n                  ng:click\x3d"$ctrl.filters.text \x3d \'\'"\n                  ng:disabled\x3d"$ctrl.filters.text.length \x3d\x3d 0"\x3e\n            \x3cspan class\x3d"glyphicon glyphicon-remove"\x3e\x3c/span\x3e\n          \x3c/button\x3e\n        \x3c/div\x3e\n      \x3c/div\x3e\n\n      \x3cdiv class\x3d"row" style\x3d"margin-top: 14px;"\x3e\n        \x3cdiv class\x3d"col-md-6 filter"\n             ng:repeat\x3d"grp_type in [\'CLS\', \'GRP\', \'GPL\']"\n             ng:if\x3d"$ctrl.groups.length \x3e 0"\x3e\n          \x3cdiv class\x3d"panel panel-default"\x3e\n            \x3cdiv class\x3d"panel-heading"\x3e\n              Filtrage par {{$ctrl.pretty_labels[grp_type]}}\n\n              \x3cbutton class\x3d"btn btn-xs pull-right" style\x3d"color: green;"\n                      ng:click\x3d"$ctrl.clear_filters( grp_type )"\x3e\n                \x3cspan class\x3d"glyphicon glyphicon-remove"\x3e\n                \x3c/span\x3e\n              \x3c/button\x3e\n              \x3cdiv class\x3d"clearfix"\x3e\x3c/div\x3e\n            \x3c/div\x3e\n\n            \x3cdiv class\x3d"panel-body"\x3e\n              \x3cdiv class\x3d"btn-group"\x3e\n                \x3cbutton class\x3d"btn btn-sm" style\x3d"margin: 2px; font-weight: bold; color: #fff;"\n                        ng:repeat\x3d"group in $ctrl.groups | filter:{type: grp_type} | orderBy:[\'name\']"\n                        ng:class\x3d"{\'vert-plus\': group.selected, \'vert-moins\': !group.selected}"\n                        ng:model\x3d"group.selected"\n                        uib:btn-checkbox\x3e\n                  {{group.name}}\n                \x3c/button\x3e\n              \x3c/div\x3e\n            \x3c/div\x3e\n          \x3c/div\x3e\n        \x3c/div\x3e\n\n        \x3cdiv class\x3d"col-md-6 filter" ng:if\x3d"$ctrl.grades.length \x3e 1"\x3e\n          \x3cdiv class\x3d"panel panel-default"\x3e\n            \x3cdiv class\x3d"panel-heading"\x3e\n              Filtrage par niveau\n\n              \x3cbutton class\x3d"btn btn-xs pull-right" style\x3d"color: green;"\n                      ng:click\x3d"$ctrl.clear_filters(\'grades\')"\x3e\n                \x3cspan class\x3d"glyphicon glyphicon-remove"\x3e\n                \x3c/span\x3e\n              \x3c/button\x3e\n              \x3cdiv class\x3d"clearfix"\x3e\x3c/div\x3e\n            \x3c/div\x3e\n\n            \x3cdiv class\x3d"panel-body"\x3e\n              \x3cdiv class\x3d"btn-group"\x3e\n                \x3cbutton class\x3d"btn btn-sm" style\x3d"margin: 2px; font-weight: bold; color: #fff;"\n                        ng:repeat\x3d"grade in $ctrl.grades | orderBy:[\'name\']"\n                        ng:class\x3d"{\'vert-plus\': grade.selected, \'vert-moins\': !grade.selected}"\n                        ng:model\x3d"grade.selected"\n                        uib:btn-checkbox\x3e\n                  {{grade.name}}\n                \x3c/button\x3e\n              \x3c/div\x3e\n            \x3c/div\x3e\n          \x3c/div\x3e\n        \x3c/div\x3e\n\n        \x3cdiv class\x3d"col-md-6 filter" ng:if\x3d"$ctrl.structures.length \x3e 1"\x3e\n          \x3cdiv class\x3d"panel panel-default"\x3e\n            \x3cdiv class\x3d"panel-heading"\x3e\n              Filtrage par \u00e9tablissements\n\n              \x3cbutton class\x3d"btn btn-xs pull-right" style\x3d"color: green;"\n                      ng:click\x3d"$ctrl.clear_filters(\'structures\')"\x3e\n                \x3cspan class\x3d"glyphicon glyphicon-remove"\x3e\n                \x3c/span\x3e\n              \x3c/button\x3e\n              \x3cdiv class\x3d"clearfix"\x3e\x3c/div\x3e\n            \x3c/div\x3e\n\n            \x3cdiv class\x3d"panel-body"\x3e\n              \x3cdiv class\x3d"btn-group"\x3e\n                \x3cbutton class\x3d"btn btn-sm" style\x3d"margin: 2px; font-weight: bold; color: #fff;"\n                        ng:repeat\x3d"structure in $ctrl.structures | orderBy:[\'name\']"\n                        ng:class\x3d"{\'vert-plus\': structure.selected, \'vert-moins\': !structure.selected}"\n                        ng:model\x3d"structure.selected"\n                        uib:btn-checkbox\x3e\n                  {{structure.name}}\n                \x3c/button\x3e\n              \x3c/div\x3e\n            \x3c/div\x3e\n          \x3c/div\x3e\n        \x3c/div\x3e\n      \x3c/div\x3e\n\n    \x3c/div\x3e\n  \x3c/div\x3e\n\n\x3c/div\x3e\n\n\x3cdiv class\x3d"col-md-8 vert-moins damier trombinoscope"\x3e\n  \x3cul\x3e\n    \x3cli class\x3d"col-xs-6 col-sm-4 col-md-3 col-lg-2 petite case vert-moins"\n        style\x3d"background-repeat: no-repeat; background-attachment: scroll; background-clip: border-box; background-origin: padding-box; background-position-x: center; background-position-y: center; background-size: 100% auto;"\n        ng:class\x3d"{\'relevant\': eleve.relevant, \'excluded\': eleve.excluded}"\n        ng:style\x3d"{\'background-image\': \'url( {{eleve.avatar}} )\' }"\n        ng:repeat\x3d"eleve in $ctrl.filtered \x3d ( $ctrl.eleves | filter:$ctrl.apply_filters() | orderBy:[\'regroupement.name\', \'lastname\'] )"\x3e\n      \x3cbutton class\x3d"btn btn-danger pull-left" style\x3d"height: 10%;"\n              title\x3d"exclure de la s\u00e9lection"\n              ng:style\x3d"{\'opacity\': eleve.excluded ? \'1\' : \'0.5\'}"\n              uib:btn-checkbox ng:model\x3d"eleve.excluded"\n              ng:if\x3d"$ctrl.current_user.can_do_batch"\x3e\n        \x3cspan class\x3d"glyphicon glyphicon-ban-circle"\x3e\x3c/span\x3e\n      \x3c/button\x3e\n      \x3ch5 class\x3d"regroupement pull-right" style\x3d"height: 10%;"\x3e{{eleve.regroupement.name}}\x3c/h5\x3e\n      \x3ca class\x3d"eleve" style\x3d"height: 90%; margin-top: 10%;"\n         ui:sref\x3d"student({uids: [eleve.id]})"\x3e\n\n        \x3cdiv class\x3d"full-name" title\x3d"{{eleve.relevant ? \'Vous \u00eates contributeur de ce student\' : \'\'}}"\x3e\n          \x3ch4 class\x3d"first-name"\x3e{{eleve.firstname}}\x3c/h4\x3e\n          \x3ch4 class\x3d"last-name"\x3e{{eleve.lastname}}\x3c/h4\x3e\n        \x3c/div\x3e\n      \x3c/a\x3e\n    \x3c/li\x3e\n  \x3c/ul\x3e\n\x3c/div\x3e\n'});
angular.module("suiviApp").component("userDetails",{bindings:{uid:"\x3c",small:"\x3c",showAvatar:"\x3c",showConcernedPeople:"\x3c",showPhones:"\x3c",showEmails:"\x3c",showClasse:"\x3c",showAddress:"\x3c",showBirthdate:"\x3c"},controller:["APIs","URL_ENT","User",function(a,e,d){var f=this;f.URL_ENT=e;f.$onInit=function(){d.get({id:f.uid}).$promise.then(function(d){f.user=d;f.showClasse&&f.user.get_actual_groups().then(function(b){f.user.actual_groups=b;f.user.actual_groups.forEach(function(b){a.get_structure(b.structure_id).then(function(a){b.structure=
a.data})})});f.showConcernedPeople&&f.user.query_people_concerned_about().then(function(a){f.concerned_people=_(a).groupBy("type");delete f.concerned_people["\u00c9l\u00e8ve"]},function(a){})},function(a){})}}],template:'\n                          \x3cdiv class\x3d"col-md-12"\x3e\n                            \x3cdiv class\x3d"avatar-container gris4 pull-left" ng:style\x3d"{\'height\': $ctrl.small ? \'44px\' : \'175px\', \'width\': $ctrl.small ? \'44px\' : \'175px\'}"\x3e\n                              \x3cimg class\x3d"avatar noir-moins"\n                                   ng:style\x3d"{\'max-height\': $ctrl.small ? \'44px\' : \'175px\', \'max-width\': $ctrl.small ? \'44px\' : \'175px\'}"\n                                   ng:src\x3d"{{$ctrl.URL_ENT + \'/\' + $ctrl.user.avatar}}"\n                                   ng:if\x3d"$ctrl.showAvatar" /\x3e\n                            \x3c/div\x3e\n                            \x3cdiv class\x3d"col-md-8 details" ng:style\x3d"{\'min-height\': $ctrl.small ? \'44px\' : \'175px\'}"\x3e\n                              \x3cdiv class\x3d"col-md-12"\x3e\n                                \x3cspan class\x3d"first-name"\n                                      ng:style\x3d"{\'font-size\': $ctrl.small ? \'100%\' : \'150%\'}"\x3e {{$ctrl.user.firstname}}\n                                \x3c/span\x3e\n                                \x3cspan class\x3d"last-name"\n                                      ng:style\x3d"{\'font-size\': $ctrl.small ? \'100%\' : \'175%\'}"\x3e {{$ctrl.user.lastname}}\n                                \x3c/span\x3e\n                              \x3c/div\x3e\n\n                              \x3cspan class\x3d"col-md-12 classe" ng:if\x3d"$ctrl.showClasse"\x3e\n                                \x3cspan ng:repeat\x3d"group in $ctrl.user.actual_groups | filter:{type: \'CLS\'}"\x3e\n                                  {{group.name}} - {{group.structure.name}}\n                                \x3c/span\x3e\n                              \x3c/span\x3e\n\n                              \x3cspan class\x3d"col-md-12 birthdate" ng:if\x3d"$ctrl.showBirthdate"\x3e\n                                n\u00e9\x3cspan ng:if\x3d"$ctrl.user.gender \x3d\x3d\x3d \'F\'"\x3ee\x3c/span\x3e le {{$ctrl.user.birthdate | date}}\n                              \x3c/span\x3e\n                              \x3cdiv class\x3d"col-md-12 email"\n                                   ng:repeat\x3d"email in $ctrl.user.emails"\n                                   ng:if\x3d"$ctrl.showEmails"\x3e\n                                \x3cspan class\x3d"glyphicon glyphicon-envelope"\x3e\n                                \x3c/span\x3e\n                                \x3ca href\x3d"mailto:{{email.address}}"\x3e{{email.address}}\x3c/a\x3e\n                              \x3c/div\x3e\n                              \x3cspan class\x3d"col-md-12 address"\n                                    ng:if\x3d"$ctrl.showAddress \x26\x26 $ctrl.user.adresse"\x3e\n                                \x3cspan class\x3d"glyphicon glyphicon-home"\x3e\n                                \x3c/span\x3e\n                                \x3cspan style\x3d"display: inline-table;"\x3e\n                                  {{$ctrl.user.address}}\n                                  \x3cbr\x3e\n                                  {{$ctrl.user.zipcode}} {{$ctrl.user.city}}\n                                \x3c/span\x3e\n                              \x3c/span\x3e\n                              \x3cdiv class\x3d"col-md-12 phone"\n                                   ng:repeat\x3d"phone in $ctrl.user.phones"\n                                   ng:if\x3d"$ctrl.showPhones"\x3e\n                                \x3cspan class\x3d"glyphicon"\n                                      ng:class\x3d"{\'glyphicon-phone\': phone.type \x3d\x3d\x3d \'PORTABLE\', \'glyphicon-phone-alt\': phone.type !\x3d\x3d \'PORTABLE\'}"\x3e\n                                  {{phone.type}}: {{phone.number}}\n                                \x3c/span\x3e\n                              \x3c/div\x3e\n                            \x3c/div\x3e\n                          \x3c/div\x3e\n\n                          \x3cfieldset class\x3d"pull-left col-md-12 parents" ng:if\x3d"$ctrl.showConcernedPeople"\x3e\n                            \x3clegend\x3ePersonnes concern\u00e9es\x3c/legend\x3e\n                            \x3cuib-accordion\x3e\n                              \x3cdiv uib-accordion-group\n                                   class\x3d"panel-default"\n                                   ng:repeat\x3d"(type, peoples) in $ctrl.concerned_people"\n                                   ng:if\x3d"type !\x3d \'Autre \u00e9l\u00e8ve suivi\'"\x3e\n                                \x3cuib-accordion-heading\x3e\n                                  \x3cspan class\x3d"glyphicon" ng:class\x3d"{\'glyphicon-menu-down\': type.is_open, \'glyphicon-menu-right\': !type.is_open}"\x3e\n                                  \x3c/span\x3e {{type}}\n                                \x3c/uib-accordion-heading\x3e\n                                \x3cul\x3e\n                                  \x3cli ng:repeat\x3d"people in peoples | orderBy:\'lastname\'"\x3e\n                                    \x3cspan ng:if\x3d"!people.relevant_to"\x3e{{people.firstname}} {{people.lastname}}\x3c/span\x3e\n                                    \x3cspan ng:if\x3d"people.relevant_to"\x3e\n                                      \x3ca ui:sref\x3d"student({uid_student: people.id})"\x3e{{people.firstname}} {{people.lastname}}\x3c/a\x3e\n                                    \x3c/span\x3e\n                                    \x3cspan ng:if\x3d"people.prof_principal"\x3e (enseignant principal)\x3c/span\x3e\n                                    \x3cspan ng:if\x3d"people.actual_subjects"\x3e\n                                      \x3cbr/\x3e\n                                      \x3cem ng:repeat\x3d"subject in people.actual_subjects"\x3e\n                                        \x3cspan class\x3d"glyphicon glyphicon-briefcase"\x3e\n                                        \x3c/span\x3e {{subject.name}}\n                                      \x3c/em\x3e\n                                    \x3c/span\x3e\n                                    \x3cspan ng:if\x3d"people.emails.length \x3e 0"\x3e\n                                      \x3cbr/\x3e\n                                      \x3cspan class\x3d"glyphicon glyphicon-envelope"\x3e\n                                      \x3c/span\x3e\n                                      \x3ca href\x3d"mailto:{{people.emails[0].address}}"\x3e{{people.emails[0].address}}\x3c/a\x3e\n                                    \x3c/span\x3e\n                                  \x3c/li\x3e\n                                \x3c/ul\x3e\n                              \x3c/div\x3e\n                            \x3c/uib-accordion\x3e\n                          \x3c/fieldset\x3e\n'});
angular.module("suiviApp").factory("Droits",["$resource","APP_PATH",function(a,e){return a(e+"/api/droits/:id",{id:"@id"},{save:{method:"POST",isArray:!0},update:{method:"PUT"}})}]);angular.module("suiviApp").factory("Onglets",["$resource","APP_PATH",function(a,e){return a(e+"/api/onglets/:id",{id:"@id"},{save:{method:"POST",isArray:!0},update:{method:"PUT",isArray:!0},delete:{method:"DELETE",isArray:!0}})}]);
angular.module("suiviApp").factory("Saisies",["$resource","APP_PATH",function(a,e){return a(e+"/api/saisies/:id",{id:"@id"},{update:{method:"PUT"}})}]);
angular.module("suiviApp").factory("User",["$resource","$rootScope","$q","APIs","URL_ENT",function(a,e,d,f,g){return a(g+"/api/users/:id",{id:"@id",expand:"@expand"},{get:{cache:!1,transformResponse:function(a){var b=angular.fromJson(a);b.is_admin=function(){return 0<b.profiles.length&&void 0!=_(b.profiles).findWhere({type:"ADM"})};b.can_do_batch=0<_("ADM DIR DOC ENS ETA EVS ORI TUT".split(" ")).intersection(_(b.profiles).pluck("type")).length;b.can_add_tab=function(a){return b.can_do_batch||1==a.length&&
a[0]==b.id};b.get_actual_groups=function(){return f.get_groups(_(b.groups).pluck("group_id")).then(function(a){b.actual_groups=a.data;return d.resolve(b.actual_groups)})};b.get_actual_subjects=function(){return f.get_subjects(_(b.groups).pluck("subject_id")).then(function(a){b.actual_subjects=a.data;return d.resolve(b.actual_subjects)})};b.query_people_concerned_about=_.memoize(function(){var a=[],e=[],g=[],h=[],m=[],n=[];return f.query_profiles_types().then(function(a){e=_(a.data).indexBy("id");
return _(b.parents).isEmpty()?d.resolve({no_parents:!0}):f.get_users(_(b.parents).pluck("parent_id"))},function(a){return d.reject(a)}).then(function(c){_(c).has("data")&&a.push(_(c.data).map(function(a){a.type="Responsable"+(1<c.data.length?"s":"")+" de l'\u00e9l\u00e8ve";return a}));return 0<b.profiles.length?f.get_structures(_(b.profiles).pluck("structure_id")):d.resolve({no_profile:!0})},function(a){return d.reject(a)}).then(function(a){return _(a).has("data")?(h=_.chain(a.data).pluck("profiles").flatten().reject(function(a){return _(["ELV",
"TUT","ENS"]).contains(a.type)}).uniq(function(a){return a.id}).value(),f.get_users(_(h).pluck("user_id"))):d.resolve({no_profile:!0})}).then(function(c){return _(c).has("data")?(h=_(h).indexBy("user_id"),a.push(_(c.data).map(function(a){a.type=e[h[a.id].type].name+" de l'\u00e9l\u00e8ve";return a})),c=_(b.groups).pluck("group_id"),f.get_groups(c)):d.resolve({no_profile:!0})},function(a){return d.reject(a)}).then(function(a){return _(a).has("data")?(g=_.chain(a.data).pluck("users").flatten().value(),
m=_(g).where({type:"ELV"}),0<m.length?f.get_users(_(m).pluck("user_id")):d.resolve({no_pupils:!0})):d.resolve({no_profile:!0})},function(a){return d.reject(a)}).then(function(b){m=_(m).indexBy("user_id");a.push(_(b.data).map(function(a){var c=1<b.data.length?"s":"";a.type="Autre"+c+" \u00e9l\u00e8ve"+c;return a}));n=_(g).where({type:"ENS"});return 0<n.length?f.get_users(_(n).pluck("user_id")):d.resolve()},function(a){return d.reject(a)}).then(function(b){n=_(n).indexBy("user_id");_(g).where({type:"PRI"});
a.push(_(b.data).map(function(a){a.type=e[n[a.id].type].name+" de l'\u00e9l\u00e8ve";f.get_subjects(_(a.groups).pluck("subject_id")).then(function(b){a.actual_subjects=b.data});return a}));return d.resolve()},function(a){return d.reject(a)}).then(function(){return d.resolve(_.chain(a).flatten().uniq(function(a){return a.id}).value())})});return b}}})}]);
angular.module("suiviApp").service("APIs",["$http","$q","Onglets","URL_ENT","APP_PATH",function(a,e,d,f,g){this.query_profiles_types=_.memoize(function(){return a.get(f+"/api/profiles_types")});this.get_users=_.memoize(function(b){return _(b).isEmpty()?e.resolve({data:[]}):a.get(f+"/api/users/",{params:{"id[]":b}})});this.get_group=_.memoize(function(b){return a.get(f+"/api/groups/"+b)});this.get_groups=_.memoize(function(b){return _(b).isEmpty()?e.resolve({data:[]}):a.get(f+"/api/groups/",{params:{"id[]":b}})});
this.get_groups_of_structures=_.memoize(function(b){return a.get(f+"/api/groups/",{params:{"structure_id[]":b}})});this.get_grades=_.memoize(function(b){return _(b).isEmpty()?e.resolve({data:[]}):a.get(f+"/api/grades/",{params:{"id[]":b}})});this.get_subjects=_.memoize(function(b){return _(b).isEmpty()?e.resolve({data:[]}):a.get(f+"/api/subjects/",{params:{"id[]":b}})});this.query_relevant_students=function(b){return a.get(g+"/api/students/relevant/"+b)};this.get_structure=_.memoize(function(b){return a.get(f+
"/api/structures/"+b)});this.get_structures=_.memoize(function(b){return a.get(f+"/api/structures/",{params:{"id[]":b}})});this.query_common_onglets_of=function(a){return d.query({"uids[]":a}).$promise.then(function(b){return e.resolve(_.chain(b).groupBy("name").toArray().select(function(b){return b.length==a.length}).flatten().groupBy("name").value())},function(a){return e.resolve({})})}}]);
angular.module("suiviApp").service("Popups",["$uibModal","$q","Onglets","Droits","Saisies","APIs","UID","User",function(a,e,d,f,g,b,h,c){this.loading_window=function(a,b,c){return swal({title:a,text:b,type:"info",showLoaderOnConfirm:!0,onOpen:function(){return swal.clickConfirm()},preConfirm:function(){return new Promise(function(a){c().then(function(a){swal.closeModal()},function(a){console.log(a);swal.closeModal();swal({title:"Erreur :(",text:a.data.error,type:"error"})})})},allowOutsideClick:!1})};
this.onglet=function(b,g,q,m){var k=["Parcours avenir","Parcours d'\u00e9ducation artistique et culturelle","Parcours sant\u00e9","Parcours citoyen"];a.open({template:'\n\x3cdiv class\x3d"modal-header"\x3e\n  \x3ch3 class\x3d"modal-title"\x3e\n    Propri\u00e9t\u00e9s de l\'onglet\n  \x3c/h3\x3e\n\x3c/div\x3e\n\n\x3cdiv class\x3d"modal-body"\x3e\n  \x3clabel\x3eTitre\x3cspan ng:if\x3d"$ctrl.onglet.names"\x3es\x3c/span\x3e :\n    \x3cinput\n      type\x3d"text"\n      placeholder\x3d"onglet personnalis\u00e9"\n      maxlength\x3d"45"\n      ng:disabled\x3d"$ctrl.onglet.names"\n      ng:model\x3d"$ctrl.onglet.name"\n      ng:maxlength\x3d"45"\n      ng:change\x3d"$ctrl.onglet.dirty \x3d true; $ctrl.name_validation()"\n      ng:if\x3d"!$ctrl.onglet.names" /\x3e\n    \x3cspan class\x3d"label label-danger" ng:if\x3d"!$ctrl.onglet.names \x26\x26 !$ctrl.valid_name"\x3eUn onglet existant porte d\u00e9j\u00e0 ce nom !\x3c/span\x3e\n\n    \x3cul ng:if\x3d"$ctrl.onglet.names"\x3e\n      \x3cli ng:repeat\x3d"name in $ctrl.onglet.names"\x3e{{name}}\x3c/li\x3e\n    \x3c/ul\x3e\n  \x3c/label\x3e\n  \x3cbutton class\x3d"btn btn-primary"\n          ng:click\x3d"$ctrl.parcours();"\n          ng:if\x3d"!$ctrl.already_has_parcours \x26\x26 !$ctrl.onglet.names"\x3eParcours \u00e9ducatifs\x3c/button\x3e\n\n  \x3cdroits uid-eleve\x3d"$ctrl.uids"\n          droits\x3d"$ctrl.droits"\n          concerned-people\x3d"$ctrl.concerned_people"\n          ng:if\x3d"$ctrl.droits"\x3e\x3c/droits\x3e\n  \x3cspan class\x3d"label label-info" ng:if\x3d"$ctrl.uids"\x3e(Par d\u00e9faut l\'\u00e9l\u00e8ve aura un acc\u00e8s en lecture/\u00e9criture \u00e0 cet onglet.)\x3c/span\x3e\n\n  \x3cdiv class\x3d"clearfix"\x3e\x3c/div\x3e\n\x3c/div\x3e\n\n\x3cdiv class\x3d"modal-footer"\x3e\n  \x3cbutton class\x3d"btn btn-danger pull-left"\n          ng:click\x3d"$ctrl.delete()"\n          ng:if\x3d"$ctrl.onglet.id || $ctrl.onglet.ids"\x3e\n    \x3cspan class\x3d"glyphicon glyphicon-trash"\x3e\x3c/span\x3e\n    \x3cspan\x3e Supprimer l\'onglet\x3c/span\x3e\n  \x3c/button\x3e\n  \x3cbutton class\x3d"btn btn-default"\n          ng:click\x3d"$ctrl.cancel()"\x3e\n    \x3cspan class\x3d"glyphicon glyphicon-remove-sign"\x3e\x3c/span\x3e\n    \x3cspan ng:if\x3d"$ctrl.onglet.name"\x3e Annuler\x3c/span\x3e\n    \x3cspan ng:if\x3d"!$ctrl.onglet.name"\x3e Fermer\x3c/span\x3e\n  \x3c/button\x3e\n  \x3cbutton class\x3d"btn btn-success"\n          ng:click\x3d"$ctrl.ok()"\n          ng:disabled\x3d"!$ctrl.onglet.names \x26\x26 (!$ctrl.onglet.name || !$ctrl.valid_name)"\x3e\n    \x3cspan class\x3d"glyphicon glyphicon-ok-sign"\x3e\x3c/span\x3e Valider\n  \x3c/button\x3e\n\x3c/div\x3e\n',
resolve:{uids:function(){return b},onglet:function(){return _(g).isNull()?{name:""}:g},all_onglets:function(){return q}},controller:["$scope","$uibModalInstance","$q","Droits","APIs","URL_ENT","DEFAULT_RIGHTS_ONGLET","UID","uids","onglet","all_onglets",function(a,b,d,e,f,g,h,l,m,n,q){a.$ctrl=a;a.uids=m;a.onglet=n;a.all_onglets=q;a.onglet.deleted=!1;a.valid_name=!0;a.already_has_parcours=_(k).intersection(a.all_onglets.map(function(a){return a.name})).length==k.length;_(a.onglet).has("id")||_(a.onglet).has("ids")?
e.query({onglet_id:a.onglet.id,"onglets_ids[]":a.onglet.ids}).$promise.then(function(b){a.droits=_(b).map(function(a){return new e(a)})},function(a){}):(a.droits=[new e({uid:l,read:!0,write:!0,manage:!0})],1==m.length&&a.droits.push(new e({uid:m[0],read:!0,write:!0,manage:!1})),a.droits=a.droits.concat(_(h).map(function(a){a=new e(a);a.dirty={profile_type:!0,read:!0,write:!0,manage:!0};return a})));1==m.length?c.get({id:m[0]}).$promise.then(function(b){a.eleve=b;a.eleve.query_people_concerned_about(m[0]).then(function(b){a.concerned_people=
b},function(a){})},function(a){}):c.get({id:l}).$promise.then(function(b){a.concerned_people=[b];return f.get_users(m)},function(a){}).then(function(b){a.concerned_people=a.concerned_people.concat(b.data)},function(a){});a.name_validation=function(){var b=_.chain(a.all_onglets).reject(function(b){return!_(a.onglet).isNull()&&a.onglet.id==b.id}).pluck("name").value();a.valid_name=!_(b).includes(a.onglet.name);return a.valid_name};a.parcours=function(){a.onglet.name=void 0;a.onglet.names=_(k).difference(a.all_onglets.map(function(a){return a.name}))};
a.ok=function(){b.close({onglet:a.onglet,droits:a.droits})};a.delete=function(){swal({title:"\u00cates-vous sur ?",text:"L'onglet ainsi que toutes les saisies et droits associ\u00e9s seront d\u00e9finitivement supprim\u00e9s !",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",confirmButtonText:"Oui, je confirme !",cancelButtonColor:"#d33",cancelButtonText:"Annuler"}).then(function(b){a.onglet.deleted="cancel"!=b.dismiss;a.ok()})};a.cancel=function(){b.dismiss()}}]}).result.then(function(a){var c=
null,k="rien";null==g?(k="created",c=d.save({uids:b,names:void 0==a.onglet.names?[a.onglet.name]:a.onglet.names}).$promise):a.onglet.deleted?(k="deleted",a.onglet["ids[]"]=a.onglet.ids,delete a.onglet.ids,delete a.onglet.id,c=d.delete(a.onglet).$promise):c=a.onglet.dirty?d.update(a.onglet).$promise:e.resolve([a.onglet]);c.then(function(c){c.action=k;"deleted"!=k&&_.chain(a.droits).reject(function(a){return"created"==k&&_(a).has("uid")&&(a.uid==h||a.uid==b)}).each(function(a){a.to_delete&&(_(a).has("id")||
_(a).has("ids"))?f.delete(a):!a.to_delete&&a.dirty&&"..."!=a.uid&&"..."!=a.profile_type&&"..."!=a.sharable_id&&_(a.dirty).reduce(function(a,b){return a||b},!1)&&(a.onglets_ids=c.map(function(a){return a.id}),(_(a).has("id")||_(a).has("ids")?f.update(a):f.save(a)).$promise.then(function(a){return!0},function(a){return!1}))});m(c)},function(){})},function(){})}}]);
